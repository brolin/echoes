define(["jquery","underscore","backbone","views/youtube_item","models/youtube_item","models/youtube_playlist_info_provider","text!./playlist-viewer.tpl.html"],function(t,e,i,s,n,o,l){var a=i.Collection.extend({model:n}),d=s.extend({initialize:function(){this.listen()},render:function(){var t=this.model.toJSON().video;return(t.status&&"suspended"===t.status.reason||t.status&&"restricted"===t.status.value)&&this.$el.hide(),e.extend(this.model.attributes,t),t=this.model.digest().toJSON(),this.$el.html(this.template(t)),this}}),h=i.View.extend({tagName:"ul",className:"clearfix unstyled ux-maker playlist-items",view:{type:d,collection:a,events:{"play-media":"playMedia"}},initialize:function(t){this.options=t},playMedia:function(t){var e,i=this.model.get("player").get("index");i&&(e=this.collection.at(i),e&&e.set({isPlaying:!1})),this.model.playMedia({type:"playlist",mediaId:this.options.info.get("id"),index:t.get("position")-1})}}),r=i.View.extend({template:l,render:function(){this.$el.html(e.template(this.template,this.model.toJSON()))}}),m=i.View.extend({tagName:"div",transition:{duration:200,css:"transition-in"},initialize:function(){this.info=new o,this.infoView=new r({model:this.info}),this.items=new h({model:this.model,info:this.info}),this.$el.append([this.infoView.el,this.items.el]),this.listenTo(this.model.youtube,"change:showPlaylistId",this.getPlaylistInfo),this.listenTo(i,"app:load-more",this.handleLoadMore),this.listenTo(this.info,"done",this.renderItems),i.trigger("app:loader-start"),this.getPlaylistInfo()},getPlaylistInfo:function(){this.info.set("id",this.model.youtube.get("showPlaylistId"))},renderItems:function(t){var s=!1;i.trigger("app:loader-end"),this.items.collection.set(e.chain(t).filter(function(t){var e=t&&t.video,i=e&&t.video.status&&t.video.status,s="private blocked suspended";return i&&s.indexOf(i.reason)>-1?!1:e?t:void 0}).value()),s=this.info.get("totalItems")!==this.items.collection.length-1,this.info.set({totalItems:this.items.collection.length,restricted:s}),this.info.sourceItems=t,this.infoView.render()}});return m});