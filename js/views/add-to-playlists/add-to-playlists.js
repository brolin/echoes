define(["jquery","underscore","backbone","./playlist-search","./playlists-list","modules/gsignin/gsignin"],function(t,s,e,i,l,n){return Timber.module("View",{el:"#playlists-viewer",initialize:function(){this.listenTo(e,"app:add-to-playlist",this.show),this.listenTo(this.model.youtube.playlists,"update",this.render),this.listenTo(this.model.youtube.playlists,"added",function(){this.model.youtube.playlists.list()}),this.listenTo(this.model.youtube.profile,"change:items",this.render),this.listenTo(this.model.user.playlists,"created",function(t){this.model.youtube.playlists.add(t.result),this.header.resetState(),this.render()}),this.listenTo(this.model.user.playlists,"removed",function(t){this.model.youtube.playlists.removeItemById(t),this.render()}),this.$el.on("hidden",s.bind(this.reset,this)),this.$el.on("show",s.bind(this.render,this)),this.header=new i({el:this.$(".modal-header"),model:this.model}),this.playlists=new l({el:this.$(".modal-body ul")}),this.gsignin=new n({el:this.$(".gsign-in")[0],scopes:this.model.user.auth.scopes,clientId:this.model.user.getClientId()}),this.listenTo(this.gsignin,"auth:success",function(){this.model.youtube.profile.connect()}),this.listenTo(this.playlists,"adding",this.addToPlaylist),this.listenTo(this.playlists,"remove",this.removePlaylist),this.filter="",this.listenTo(this.header,"search:change",this.filterPlaylist),this.listenTo(this.header,"search:add",this.createPlaylist)},render:function(){var t=this.getPlaylistsForDisplay(this.model.youtube.playlists),s=t,e=this.model.youtube.profile.isSignedIn();this.playlists.collection.reset(s,{reset:!0}),this.$el.toggleClass("user-not-signed-in",!e),this.$el.toggleClass("add-new-playlist",!s.length)},getPlaylistsForDisplay:function(t){var s=this.filter,e=t.filter(function(t){return t.getTitle().toLowerCase().indexOf(s)>-1},this);return e.map(function(t){return t.toJSON()})},show:function(t){this.currentVideo=t,this.$el.modal("show")},addToPlaylist:function(t){var s=this.currentVideo.id;this.model.youtube.playlists.insert(t,s),this.model.set("playlist-add",!1,{silent:!0})},renderGapiResult:function(t){var s="the video has been successfuly added to this playlist.",e=t.id;t.set({message:s,adding:!1},{silent:!0}),this.model.user.playlists.list(e),this.render()},filterPlaylist:function(t){this.filter=t,this.render()},reset:function(){this.playlists.reset(),this.filter=""},createPlaylist:function(t){t.length&&this.model.user.playlists.createPlaylist(t)},removePlaylist:function(t){this.model.user.playlists.removePlaylist(t.id)}})});