define(["jquery","underscore","backbone","./youtube/track_info","./youtube/playlist_info","text!templates/youtube_custom_styles.css"],function(e,t,i,l,s,o){var a=i.View.extend({el:"#youtube-player-container",events:{"click .show-player":"show","click .pause":"pause","click .play":"playVideo","click .volume-toggle":"toggleVolume","click .next":"playNext","click .previous":"playPrevious","click .fullscreen":"toggleFullScreen","mouseout .volume-down":"hideVolume","mouseout .volume-up":"hideVolume","mouseover .volume-down":"showVolume","mouseover .volume-up":"showVolume"},initialize:function(){this.playerModel=this.model.get("player"),this.listenTo(this.playerModel,"change:mediaId",this.onMediaChanged),this.listenTo(this.playerModel,"change:index",this.playMedia),this.currentTrackInfoView=new l({el:this.$(".current-track-info-container"),model:this.model.youtube.info}),this.currentPlaylistView=new s({el:this.$(".playlist-info"),model:this.model}),this.$volume=this.$("#volume-ctrl").slider({min:0,max:100,orientation:"vertical",slide:t.bind(function(e,t){this.updateVolume(t.value)},this)}),this.listenTo(this.currentTrackInfoView,"seek",this.seekToSeconds),window.onYouTubeIframeAPIReady=t.bind(this.createPlayer,this);require(["http://www.youtube.com/iframe_api?&ghost="],function(){})},createPlayer:function(){var e=this.playerModel.get("size");this.player=new YT.Player("player",{height:String(e.height),width:String(e.width),playerVars:{autoplay:0,enablejsapi:1,autohide:0,controls:1,fs:1,modestbranding:1},events:{onReady:t.bind(this.onPlayerReady,this),onStateChange:t.bind(this.onPlayerStateChange,this)}})},onPlayerReady:function(){var e=this.player.isMuted();e?this.mute():this.unMute(),this.setVolume(),this.queue&&this.play(this.queue),this.player.addEventListener("onStateChange",t.bind(this.onPlayerStateChange,this))},onPlayerStateChange:function(e){var i,l,s;e.data===YT.PlayerState.PAUSED&&this.toggleNowPlaying(!1),e.data===YT.PlayerState.PLAYING&&(s=this.player.getVideoData().video_id,i=this.playerModel.get("mediaId"),this.playerModel.isCurrentPlaylist()&&(l=this.player.getPlaylistIndex(),l=-1===l?0:l,this.model.youtube.fetchPlaylistInfo(i),i=this.player.getPlaylist()[l],this.updateIndex(l)),s&&s!==i&&(i=s),this.model.youtube.fetchMediaById(i),this.toggleNowPlaying(!0)),t.once(t.bind(this.setVolume,this))},onMediaChanged:function(e){this.play(e)},play:function(e){return this.player&&this.player.loadVideoById?(this.player.stopVideo(),this.player.clearVideo&&this.player.clearVideo(),this.playMedia(e),this.$el.addClass("yt-playing"),void this.show(null,"show")):(this.show(),void(this.queue=e))},updateIndex:function(e){this.playerModel.set("index",e)},playMedia:function(e){e.isCurrentPlaylist()?this.playPlaylist(e.getPlaylistId(),e.getPlaylistCurrentIndex()):this.player.loadVideoById(e.get("mediaId"),0,"large")},pause:function(){this.player.pauseVideo()},playVideo:function(){this.player.playVideo()},playPlaylist:function(e,i){var l;return this.player?(l=this.player.getPlaylistId(),t.isNull(l)||e!==l?void(this.player.loadPlaylist&&this.player.loadPlaylist({listType:"playlist",list:e,index:i,suggestedQuality:"large"})):void this.player.playVideoAt(i)):void this.play(this.model.get("player"))},decreaseVolume:function(){this.updateVolume(this.player.getVolume()-5),this.showVolume()},increaseVolume:function(){this.updateVolume(this.player.getVolume()+5),this.showVolume()},setVolume:function(){var e=this.player.getVolume();this.updateVolume(e),this.$volume.slider({value:e})},toggleVolume:function(){var e=this.$(".volume-master"),t=e.hasClass("volume-mute");t?this.unMute():this.mute()},mute:function(){this.player.mute(),this.$(".volume-master").addClass("volume-mute")},unMute:function(){this.player.unMute(),this.$(".volume-master").removeClass("volume-mute")},updateVolume:function(e){0>e&&(e=0),e>=100&&(e=100),this.player.setVolume(e)},hideVolume:function(){this.$el.addClass("hide-volume")},showVolume:function(){this.$el.removeClass("hide-volume")},playNext:function(){this.player.nextVideo()},playPrevious:function(){this.player.previousVideo()},toggleFullScreen:function(){var e=this.playerModel,t=e.getSize();e.toggleFullScreen(),this.player.setSize(t.width,t.height),this.$el.toggleClass("fullscreen",e.get("fullScreen"))},toggleNowPlaying:function(e){this.$el.toggleClass("yt-playing",e)},show:function(e,t){e&&e.preventDefault(),this.visible&&"show"!==t?this.hide(e):(this.$el.addClass("show-youtube-player"),this.visible=!0)},hide:function(e){e&&e.preventDefault(),this.$el.removeClass("show-youtube-player"),this.visible=!1},insertCustomStyles:function(){var e=t().getPortviewSize(),i=this.$("#youtube-full-screen");customStyle=t.template(o,e),i.length?i.replaceWith(customStyle):this.$el.append(customStyle)},seekToSeconds:function(e){this.player.seekTo(e,!0)}});return a});