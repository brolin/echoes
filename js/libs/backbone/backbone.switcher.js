(function(){function r(e){this.sw_keys=e.switcher.key.split(" "),this.sw_views=e.switcher.views,this.currentView=null,this.sw_currentResource=null}var e=this._,t=this.Backbone;if(!e||!t||!JSON)return;var n=function(t){return function(n){var i=n.initialize||function(){};return n.initialize=function(){this.switcher&&(e.extend(this,new r(this)),this._init()),i.apply(this,arguments),this.trigger("after:initialize")},t.call(this,n)}};t.View.extend=n(t.View.extend),r.prototype={_init:function(){this._parseOptions(),e.each(this.sw_keys,this._addListener,this),this.listenToOnce(this,"after:initialize",this._start)},_addListener:function(e){this.listenTo(this.model,"change:"+e,this._handleResource)},_start:function(){this._handleResource(this.model,this.model.get(this.sw_keys))},_parseOptions:function(){this.switcher.options&&this.switcher.options.target?this.$target=this.$(this.switcher.options.target):this.$target=this.$el},_handleResource:function(e,t){this.sw_currentResource=t,this.currentView&&this.currentView.stopListening(),this._renderResource()},_renderResource:function(){this.currentView&&(this.currentView.$el.removeClass(this.switcher.transition.cssIn),this.currentView.remove()),this._render()},_render:function(){this.currentView=new this.sw_views[this.sw_currentResource]({model:this.model}),this.$target.append(this.currentView.el),this.currentView=this.currentView,this.trigger("after:render"),this.$target.addClass(this.switcher.transition.cssIn)}}})();