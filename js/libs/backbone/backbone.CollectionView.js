define(["underscore","backbonesrc"],function(e){function t(e){this.cv_views=[],this.$target=e.view.target?e.$(e.view.target):e.$el,e.collection||(this._sourceRender=e.render||function(){},this.collection=e.view&&e.view.collection?new e.view.collection:new i.Collection)}var e=this._,i=this.Backbone;if(e&&i&&JSON){t.prototype={render:function(){this.resetViews(),this.cv_views=this.collection.map(this.createItem,this),this.$target.append(e.map(this.cv_views,this.prepareItem,this)),this.trigger("render:collection")},createItem:function(e){var t=this.view.type;return new t({model:e})},prepareItem:function(t){return e.each(this.view.events,function(e,i){this.listenTo(t,i,this[e])},this),t.render().el},_listenToLastestView:function(e,t){this.cv_views[this._currentViewIndex]&&this.listenTo(this.cv_views[this._currentViewIndex],t,this[e])},renderItem:function(t){{var i=this.cv_views.length;this.view.type}this.cv_views.push(this.createItem(t)),this.$target.append(this.prepareItem(e.last(this.cv_views),i))},addItems:function(t){var i=e.map(t,this.createItem,this);return this.$target.append(e.map(i,this.prepareItem,this)),this},resetViews:function(){e.each(this.cv_views,function(e){this.stopListening(e)},this),e.invoke(this.cv_views,"remove"),this.cv_views.length=0},_hide:function(){this.$el.removeClass(this.transition.css)},_show:function(){this.$el.addClass(this.transition.css)}};var s=function(){i.trigger("extend:View",{key:"view",extension:t,initialize:function(){this.listenTo(this.collection,"reset destroy remove sort",function(){this.render()}),this.listenTo(this.collection,"add",function(e){this.renderItem(e)})}})};return{beam:s}}});